# ERD 와 정규화 과정

ERD 는 데이터베이스를 구축할 때 가장 기초적인 뼈대 역할을 하며 릴레이션 간의 관계들을 정의한 것.
만약 서비스를 구축한다면 가장 먼저 신경써야 할 부분이며 이 부분을 신경 안쓰고 서비스를 구축한다면 단단하지 않은 골조로 건물을 짓는 것

## ERD 의 중요성

ERD는 시스템의 요구 사항을 기반으로 작성되며 이 ERD를 기반으로 데이터베이스를 구축한다.
데이터베이스를 구축한 이후에도 디버깅 또는 비즈니스 프로세스 재설계가 필요한 경우에 설계도 역할을 담당하기도 한다

하지만 ERD 는 관계형 구조로 표현할 수 있는 데이터를 구성하는데 유용할 수 있지만 정형 데이터를 충분히 표현할 수 없다는 단점.

## 정규화 과정

정규화 과정은 릴레이션 간의 잘못된 종속 관계로 인해 데이터베이스 이상 현상이 일어나 이를 해결하거나
저장 공간을 효율적으로 사용하기 위해 릴레이션을 여러 개로 분리하는 과정이다.

데이터베이스 이상 현상이란 회원이 한 개의 등급을 가져야 하는데 3개의 등급을 갖거나 삭제할 때 필요한 데이터가 같이 삭제되고
데이터를 삽입해야하는데 하나의 필드 값이 null이 되면 안되어서 삽입하기 어려운 현상 등을 말한다.

정규화 과정은 정규형 원칙을 기반으로 정규형을 만들어가는 과정이며 정규화된 정도는 정규형으로 표현한다.
기본 정규형인 제1정규형, 제2정규형, 제3정규형, 보이스/코드 정규형이 있고 고급 정규형인 제4정규형, 제5정규형이 있다.
이 중 기본 정규형인 제1,2,3정규형, 보이스/코드 정규형을 알아볼 것.

### 정규형 원칙
정규형의 원칙이란 같은 의미를 표현하는 릴레이션이지만 좀 더 좋은 구조로 만들어야 하고 자료의 중복성을 감소해야 하고
독립적인 관계는 별개의 릴레이션으로 표현해야 하며 각각의 릴레이션은 독립적인 표현이 가능해야 하는 걸 말한다.

### 제1정규형

릴레이션의 모든 도메인이 더 이상 분해될 수 없는원자 값만으로 구성되어야 한다.
릴레이션의 속성 값 중에서 한 개의 기본키에 대해 두개 이상의 값을 가지는 반복 집합이 있어선 안된다.
만약 반복 집합이 있다면 제거해야 한다.

![image](https://github.com/user-attachments/assets/1045a107-29f6-4de3-8c57-08e5cca0db32)

### 제2정규형

릴레이션이 제1정규형이며 부분 함수의 종속성을 제거한 형태를 말한다.
부분 함수의 종속성 제거란 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속적인 걸 말한다.

![image](https://github.com/user-attachments/assets/b6608b9b-c246-4111-9901-16bd91d35583)

### 제3정규형

제2정규형이고 기본키가 아닌 모든 속성이 이행적 함수 종속을 만족하지 않는 상태를 말한다

#### 이행적 함수 종속
이행적 함수 종속이란 A -> B 와 B -> C가 존재하면 논리적으로 A -> C가 성립하는데
이때 집합 C가 집합 A에 이행적으로 함수 종속이 되었다고 한다.

![image](https://github.com/user-attachments/assets/2c1341e1-201c-4220-a66a-748e5f5a98c6)

예를 들어 다음 경우에는 주문 정보 테이블에서 회원ID → 이름, 회원ID → 연락처라는 종속 관계가 성립하는데
 회원ID는 이름과 연락처를 결정하고 동시에 주문코드가 회원ID를 결정하는 구조를 가진다.
따라서 주문코드 → 회원ID → 이름, 연락처가 되어, 주문코드가 이름, 연락처도 결정하게 되므로 이행적 함수 종속.

![image](https://github.com/user-attachments/assets/a9e4a7ff-20ca-463f-b58d-360e95c70583)

따라서 이 관계를 제거하기 위해 회원 정보를 별도의 테이블로 분리함으로써 제3정규화.

### 보이스/코드 정규화

보이스/코드 정규형은 제3정규형이고 결정자가 후보키가 아닌 함수 종속 관계를 제거해 릴레이션의 함수 종속 관계에서
모든 결정자가 후보키인 상태를 말한다.

- 결정자 : 함수 종속 관계에서 특정 종속자를 결정짓는 요소, 'X -> Y' 일 때 X는 결정자, Y는 종속자.

요구사항이 다음과 같다 해보자
- 각 과목에 대해 한 학생은 오직 한 강사의 강의만 수강
- 각 교수는 한 과목만 담당
- 한 과목은 여러 강사가 담당할 수 있다

![image](https://github.com/user-attachments/assets/9a7c2612-1a01-4daa-ae28-bd00d70892b8)

앞의 릴레이션을 보면 [학번.과목] 또는 [학번,교수]가 후보키가 되며 만약 김용주라는 교수가 데이터베이스라는 과목을 담당한다 할 때 이를 삽입하려면 학번이 null인 문제가 발생.
또한 이 릴레이션은 다음과 같은 함수 종속 다이어그램을 가진다

![image](https://github.com/user-attachments/assets/4feb0a3f-ee31-4348-b336-9de4a7cfaa7f)

즉 교수 속성이 결정자지만 후보키가 아니므로 이 강사 속성을 분리해야 한다.

![image](https://github.com/user-attachments/assets/e28e664f-c6f7-4b86-80aa-464c29f77ae4)

앞 그림처럼 김용주 - 데이터베이스가 제대로 들어갔으며 학번-교수/과목-교수로 잘 분배된 모습을 볼 수 있다.

참고로 이렇게 정규형 과정을 거쳐 테이블을 나눈다 해서 성능이 100% 좋아지는 건 아니다. 성능은 좋아질 수도 나빠질 수도.
테이블을 나누게 되면 어떠한 쿼리는 조인해야 하는 경우도 발생해 오히려 느려질 수도 있기 때문에 서비스에 따라 정규화 또는 비정규화과정을 진행해야 한다.
